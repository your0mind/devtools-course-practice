# Лабораторная работа #1: Настройка окружения

- [Цели](#Цели)
- [Задачи](#Задачи)
- [Общий порядок выполнения](#Общий-порядок-выполнения)
- [Типичные ошибки](#Типичные-ошибки)
- [Детальные инструкции](#Детальные-инструкции)
  - [Первичная настройка](#Первичная-настройка)
  - [Выполнение лабораторной](#Выполнение-лабораторной)
  - [Тестирование на Travis-CI](#Тестирование на Travis-CI)
  - [Ревью кода](#Ревью-кода)

---------------------------------------------

<!-- TODO
  - Описать инсталляцию QtCreator (подумать про CLion)

-->

## Цели

  1. Ознакомиться с общей процедурой приема лабораторных работ.
  1. Познакомиться с инфраструктурой GitHub + TravisCI и принятым там процессом
     разработки (на примере [Integration Manager Workflow][imworkflow]).
  1. Получить первичные навыки использования таких инструментов как Git,
     GoogleTest, CMake и QtCreator.

## Задачи

  1. Подготовить рабочее окружение
     - Установить и настроить все необходимые инструменты
     - Получить исходные коды, построить проект и запустить имеющиеся тесты
  1. Реализовать несколько модульных тестов на уже существующий компонент
  1. Интегрировать свои изменения в центральный репозиторий
     - Прислать изменения в виде pull request
     - Добиться прохождения автоматических проверок на TravisCI
     - Пройти рецензию кода

## Общий порядок выполнения

  1. Инсталлируйте и настройте Git, CMake и QtCreator.
  1. Зарегистрируйтесь на GitHub. Создайте свой форк [центрального
     репозитория][central-repo] и склонируйте его к себе на машину.
  1. Соберите проект и убедитесь в его работоспособности, запустив модульные
     тесты на компонент `complex-number`. Изучите общую организацию
     данного компонента.
  1. В отдельной ветке Git выполните задание лабораторной работы:
     - Создайте новую ветку Git с именем вида `YOUR-NAME-lab1`.
     - В директории
       `devtools-course-practice/modules/complex-number/test/` заведите
       свой личный файл для тестов с именем вида
       `test_YOUR_NAME_complex_number.cpp`.
     - Реализуйте в этом файле не менее 5 тестов на класс `ComplexNumber`. Если
       некоторые из ваших тестов будут падать по причине некорректной, на ваш
       взгляд, реализации, стоит оставить тесты, но приписать в начало их имени
       ключевое слово `DISABLED_`. В таком случае преподаватели смогут устранить
       найденный дефект.
     - Убедитесь, что ваши тесты компилируются и запускаются вместе с
       остальными.
  1. Включите тестирование своего форка на TravisCI и убедитесь, что ваши
     изменения успешно проходят тестирование. Для этого пошлите свои изменения в
     виде pull request на GitHub в свой же репозиторий.
  1. Когда вы убедитесь в корректности своего кода, пошлите свои изменения в
     виде pull request на GitHub и пройдите рецензию кода (два сокурсника и
     преподаватель).
     - Убедитесь, что ваши тесты компилируются и запускаются вместе с
       остальными уже на центральном [TravisCI][travis].

## Типичные ошибки

Ниже приведены типичные ошибки, при наличии которых лабораторная не будет
принята:

  - Работа велась в ветке с именем `master`.
  - Изменение файлов вне своего личного файла. Так, например, файл
    `test_korniakov_kirill_complex_number.cpp` должен остаться неизменным.
  - Ваши тесты должны быть уникальны, нельзя просто копировать уже имеющиеся.
    Постарайтесь протестировать какие-то интересные и нетривиальные случаи.

## Детальные инструкции

### Первичная настройка

  1. Зарегистрируйтесь на GitHub. Предпочтительно использование аккаунта, из
     котого понятно ваше имя.
  1. Установите и настройте себе Git, используя инструкции например
     [отсюда][help-git-mp2] или [отсюда][help-git].
  1. Создайте форк [нашего проекта][central-repo], затем клонируйте репозиторий
     к себе на рабочую машину. Все необходимые инструкции можно найти
     [здесь][help-fork].
  1. Инсталлируйте приложение CMake.
  1. Инсталлируйте IDE QtCreator. В принципе, вы можете разрабатываться в IDE
     Microsoft Visual Studio, любой другой IDE, или в простом текстовом
     редакторе. CMake допускает все эти варианты, но преподаватели не всегда
     смогут вам помочь, если окружение не будет стандартным.

### Выполнение лабораторной

  1. Создайте новую ветку, в которой вы будете работать над лабораторной:

        $ cd devtools-course-practice
        $ git checkout -b SECONDNAME-FIRSTNAME-lab1

  1. Сгенерируйте проект для какой-либо IDE при помощи CMake. __ВНИМАНИЕ:__
     настоятельно рекомендуется использовать out-of-source build, чтобы отделить
     исходники от результатов компиляции. Далее скомпилируйте проект в IDE,
     запустите тесты и убедитесь, что все они проходят.

  1. Также полезно попробовать выполнить тестирование из консольной строки. Для
     этого нужно открыть консоль, перейти в корень директории с проектом и
     запустить команду ниже. Имено эта команда используется для тестирования на
     CI сервере, поэтому полезно пользоваться ей локально.

        $ ctest -VV -S devtools_test.cmake

  1. Создайте новый файл для своих собственных тестов. Ему нужно дать имя вида
     `test_korniakov_kirill_complex_number.cpp` и разместить в директории
     `devtools-course-practice/modules/complex-number/test/`. Можете
     использовать следующую заготовку для начала.

     ```cpp
     // Copyright 2017 Korniakov Kirill

     #include <gtest/gtest.h>

     #include "include/complex_number.h"

     TEST(Korniakov_Kirill_ComplexNumberTest, Can_Create_Zero) {
         // Arrange
         double re = 0.0;
         double im = 0.0;

         // Act
         ComplexNumber z(re, im);

         // Assert
         EXPECT_EQ(re, z.getRe());
         EXPECT_EQ(im, z.getIm());
     }
     ```

     Требования к файлам:
       - Первая строка должна быть комментарием вида:

         ```txt
         Copyright [year] <Copyright Owner>
         ```

       - В качестве отступов не должны использоваться символы табуляции. Нужно
         использовать последовательность из пробелов.
       - Подробнее про требования по стилю кода можно прочитать здесь -
         [Google C++ Style Guide][style-guide]

  1. Далее нужно убедиться, что ваш файл добавлен в проект. Он должен
     подцепиться автоматически, нужно только перегенерировать проект при помощи
     CMake. IDE либо сама предложит это сделать, либо нужно запустить CMake в
     той же директории, что и раньше. На консоли вы должны увидеть результат
     выполнения своего теста:

     ```txt
     [----------] 1 test from Korniakov_Kirill_ComplexNumberTest
     [ RUN      ] Korniakov_Kirill_ComplexNumberTest.Can_Create_Zero
     [       OK ] Korniakov_Kirill_ComplexNumberTest.Can_Create_Zero (0 ms)
     [----------] 1 test from Korniakov_Kirill_ComplexNumberTest (0 ms total)
     ```

  1. Теперь вы готовы к тому, чтобы реализовать свои собственные тесты. Добавьте
     не менее 5 штук в файл `test_korniakov_kirill_complex_number.cpp`, всякий
     раз убеждаясь, что проект все еще компилируется, и все тесты проходят. Для
     этого можно запускать тестирование в IDE или из командной строки:

             $ ctest -VV -S devtools_test.cmake

     Время от времени делайте локальные коммиты:

        $ git add test_korniakov_kirill_complex_number.cpp
        $ git commit -m "Added new tests for lab1"

  1. Далее сделайте `git push` в свой форк проекта:

        $ git push origin HEAD

  1. Если нужно будет что-то поправить, используйте следующие команды:

        ```bash
        # Editing file with tests ...
        $ git add test_korniakov_kirill_complex_number.cpp
        $ git commit -m "Updated tests"
        $ git push origin HEAD
        ```

Когда вы посчитаете, что закончили реализацию новых тестов, можно перейти к
процедуре интеграции в центральный репозиторий.

### Тестирование на Travis-CI

  1. Зайдите на https://travis-ci.org и залогинтесь при помощи своего GitHub
     аккаунта. Включите тестирование своего репозитория как было показано на
     лекции. Для этого нужно обновить список своих репозиториев и включить
     тестирование на своем форке репозитория `devtools-course-practice`.
  1. Затем необходимо необходимо сделать [pull-request][help-pr] в свой же
     репозиторий. В названии pull-request нужно указать свою фамилию и номер
     лабораторной, например _"Корняков - Лабораторная работа #0"_.
  1. Когда вы это сделаете, Travis должен будет запустить тестирование. Зайдите
     на страничку с билдом и убедитесь, что все конфигурации успешно прошли
     тестирование.
  1. Если выявились какие-то проблемы, исправьте их, и обновите pull-request:

        ```bash
        # Editing files ...
        $ git commit -m "Updated tests"
        $ git push origin HEAD
        ```

### Ревью кода

  1. Затем необходимо необходимо сделать [pull-request][help-pr] в центральный
     репозиторий. В своем форке пулл-реквест вы можете закрыть, поскольку эти
     коммиты потом придут к вам из `upstream/master`.
  1. Первым делом необходимо убедиться, что успешно прошло тестирование на
     [Travis CI][travis]. Вероятность того, что что-то пойдет не так -- невелика,
     но ниже приведены инструкции на тот случай, если что-то нужно поправить.
  1. Далее необходимо пройти ревью кода от двух своих сокурсников. Пригласите их
     к дискуссии, дабавив в pull reqeust комментарий вида @github-name (например
     @kirill-korniakov).
  1. Если будут замечания к вашему коду, вам нужно добавлять коммиты в
     свою ветку, и пулл-реквест будет автоматически обновляться.

        # Editing file with tests ...
        $ git add test_korniakov_kirill_complex_number.cpp
        $ git commit -m "Updated tests"
        $ git push origin HEAD

  1. Рецензия считается незавершенной, пока вы не получите два комментария вида
     :+1: (пишется как `:+1:`). Наличие такого значка фактически означает
     одобрение коллегой ваших изменений. Затем необходимо аналогичным образом
     пригласить одного из преподавателей и пройти окончательное ревью.

После прохождения ревью код будет влит в основную ветку `master`, и лабу можно
считать завершенной. Датой сдачи лабораторной будет считаться дата вливания.

<!-- LINKS -->

[group]:        https://groups.google.com/forum/#!forum/devtools-course
[topics]:       https://docs.google.com/spreadsheet/ccc?key=0AsBBkrQIoSbjdEdTUFRsaUw3LV92eVhwXzYtb0tZNHc#gid=3
[travis]:       https://travis-ci.org/UNN-VMK-Software/devtools-course-practice/pull_requests
[central-repo]: https://github.com/UNN-VMK-Software/devtools-course-practice
[help-git-mp2]: https://github.com/UNN-VMK-Software/mp2-lab1-set#Инструкция-по-выполнению-работы
[help-git]:     https://help.github.com/articles/set-up-git
[help-fork]:    https://help.github.com/articles/fork-a-repo
[help-pr]:      https://help.github.com/articles/using-pull-requests
[gfm]:          https://help.github.com/articles/github-flavored-markdown
[imworkflow]:   https://git-scm.com/book/en/v2/Distributed-Git-Distributed-Workflows#Integration-Manager-Workflow
[style-guide]:  https://google.github.io/styleguide/cppguide.html
